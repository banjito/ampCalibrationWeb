<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login | AMP Calibration</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm" type="module"></script>
  <script src="config.js"></script>
  <script src="auth.js" defer></script>
</head>
<body class="bg-gray-100">
  
  <!-- Header -->
  <header class="bg-green py-4">
    <div class="container mx-auto px-4">
      <div class="flex items-center justify-between">
        <div class="flex items-center">
          <a href="index.html" class="header-logo-link">
            <img src="img/logo/header.svg" alt="AMP Calibration" class="header-logo">
          </a>
        </div>
        <nav class="flex items-center gap-4">
          <a href="index.html" class="text-white text-sm font-semibold header-nav-link">HOME</a>
          <span class="text-white opacity-40">|</span>
          <a href="services.html" class="text-white text-sm font-semibold header-nav-link">SERVICES</a>
          <span class="text-white opacity-40">|</span>
          <a href="about.html" class="text-white text-sm font-semibold header-nav-link">ABOUT</a>
          <span class="text-white opacity-40">|</span>
          <a href="contact.html" class="text-white text-sm font-semibold header-nav-link">CONTACT</a>
        </nav>
      </div>
    </div>
  </header>

  <!-- Login Section -->
  <section class="min-h-screen flex items-center justify-center py-20">
    <div class="container mx-auto px-4">
      <div class="max-w-md mx-auto">
        <!-- Login Card -->
        <div class="bg-green border-2 border-white rounded-lg shadow-lg p-8 sm:p-12">
          <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-white mb-2 font-horizon">LOGIN</h1>
            <p class="text-white/80 font-arp-light">Enter your email to receive a magic link</p>
          </div>

          <!-- Login Form -->
          <form id="loginForm" class="space-y-6">
            <div>
              <label for="email" class="block text-white text-sm font-semibold mb-2 font-benzin">
                EMAIL ADDRESS
              </label>
              <input
                type="email"
                id="email"
                name="email"
                required
                placeholder="your@email.com"
                class="w-full bg-white/10 border-2 border-white/50 rounded-lg px-4 py-3 text-white placeholder-white/60 focus:outline-none focus:border-white focus:bg-white/20 transition-colors font-cm-geom"
              />
            </div>

            <!-- Error/Success Messages -->
            <div id="message" class="hidden text-sm font-arp-light"></div>

            <!-- Submit Button -->
            <button
              type="submit"
              id="submitBtn"
              class="w-full border-2 border-white text-white px-8 py-3 rounded-full hover:bg-white hover:text-green transition-colors font-medium tracking-wide font-benzin disabled:opacity-50 disabled:cursor-not-allowed"
            >
              SEND MAGIC LINK
            </button>
          </form>

          <!-- Info Message -->
          <div class="mt-6 text-center">
            <p class="text-white/70 text-sm font-arp-light">
              Check your email for a login link. No password needed.
            </p>
          </div>
        </div>

        <!-- Back to Home -->
        <div class="mt-6 text-center">
          <a href="index.html" class="text-green hover:opacity-80 transition-opacity font-semibold">
            ‚Üê Back to Home
          </a>
        </div>
      </div>
    </div>
  </section>

  <script>
    // Wait for Supabase to be ready
    document.addEventListener('DOMContentLoaded', () => {
      const form = document.getElementById('loginForm');
      const messageDiv = document.getElementById('message');
      const submitBtn = document.getElementById('submitBtn');
      const emailInput = document.getElementById('email');

      // Check if already logged in
      getCurrentUser().then(result => {
        if (result.user && !result.error) {
          // Already logged in, redirect to dashboard
          window.location.href = '/dashboard';
        }
      });

      // Setup auth state listener for when user clicks magic link in email
      setupAuthStateListener((session) => {
        if (session) {
          window.location.href = '/dashboard';
        }
      });

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const email = emailInput.value.trim();
        
        if (!email) {
          showMessage('Please enter your email address', 'error');
          return;
        }

        // Disable button
        submitBtn.disabled = true;
        submitBtn.textContent = 'SENDING...';

        // Send magic link
        const result = await handleMagicLinkLogin(email);

        if (result.success) {
          showMessage('Magic link sent! Check your email and click the link to login.', 'success');
          emailInput.value = '';
        } else {
          showMessage(result.error || 'Failed to send magic link. Please try again.', 'error');
          submitBtn.disabled = false;
          submitBtn.textContent = 'SEND MAGIC LINK';
        }
      });

      function showMessage(text, type) {
        messageDiv.textContent = text;
        messageDiv.className = `text-sm font-arp-light ${type === 'error' ? 'text-red-200' : 'text-green-200'}`;
        messageDiv.classList.remove('hidden');
        
        // Auto hide success messages after 10 seconds
        if (type === 'success') {
          setTimeout(() => {
            messageDiv.classList.add('hidden');
          }, 10000);
        }
      }
    });
  </script>

</body>
</html>

