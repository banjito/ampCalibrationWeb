<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HR Dashboard | AMP Calibration</title>
  <link rel="icon" type="image/svg+xml" href="img/icon/icon01.svg">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
  <script src="config.js"></script>
  <script src="auth.js" defer></script>
  <script src="sidebar.js" defer></script>
</head>
<body class="bg-gray-50">
  <!-- Include Global Sidebar -->
  <div id="sidebarContainer"></div>
  <script>
    (function() {
      fetch('sidebar.html')
        .then(response => response.text())
        .then(html => {
          const container = document.getElementById('sidebarContainer');
          if (container) {
            container.innerHTML = html;
            requestAnimationFrame(() => {
              if (typeof initSidebar === 'function') {
                initSidebar();
              } else {
                setTimeout(() => {
                  if (typeof initSidebar === 'function') {
                    initSidebar();
                  }
                }, 100);
              }
            });
          }
        })
        .catch(error => {
          console.error('Error loading sidebar:', error);
        });
    })();
  </script>

  <!-- Header -->
  <header class="bg-green py-4">
    <div class="container mx-auto px-4">
      <div class="flex items-center justify-between">
        <!-- Logo and Sidebar Toggle -->
        <div class="flex items-center gap-4">
          <button
            type="button" onclick="document.dispatchEvent(new CustomEvent('basecoat:sidebar'))"
            class="text-white hover:opacity-80 transition-opacity p-2"
            aria-label="Toggle sidebar"
          >
            <i data-lucide="menu" class="w-6 h-6"></i>
          </button>
          <a href="index.html" class="header-logo-link">
            <img src="img/logo/header.svg" alt="AMP Calibration" class="header-logo">
          </a>
        </div>
        
        <!-- Navigation -->
        <nav class="flex items-center gap-4">
          <a href="index.html" class="text-white text-sm font-semibold header-nav-link">HOME</a>
          <span class="text-white opacity-40">|</span>
          <a href="jobs.html" class="text-white text-sm font-semibold header-nav-link">JOBS</a>
          <span class="text-white opacity-40">|</span>
          <a href="services.html" class="text-white text-sm font-semibold header-nav-link">SERVICES</a>
          <span class="text-white opacity-40">|</span>
          <a href="about.html" class="text-white text-sm font-semibold header-nav-link">ABOUT</a>
          <span class="text-white opacity-40">|</span>
          <a href="contact.html" class="text-white text-sm font-semibold border border-white rounded px-4 py-2 header-nav-button header-nav-home">CONTACT US</a>
        </nav>
      </div>
    </div>
  </header>

  <main class="min-h-screen py-12">
    <div class="container mx-auto px-4 max-w-7xl">
      
      <!-- Loading State -->
      <section id="hrLoading" class="flex items-center justify-center py-20">
        <div class="text-center">
          <div class="inline-flex items-center justify-center w-16 h-16 bg-green rounded-2xl mb-6 animate-pulse">
            <i data-lucide="loader-2" class="w-8 h-8 text-white animate-spin"></i>
          </div>
          <h2 class="text-2xl font-bold text-gray-900 font-horizon mb-2">CHECKING PERMISSIONS</h2>
          <p class="text-gray-500 font-raleway-light">Please wait while we verify your access...</p>
        </div>
      </section>
      
      <!-- Authorized Content -->
      <section id="hrContent" class="hidden">
        <!-- Page Header -->
        <div class="mb-12">
          <div class="flex items-center gap-4 mb-4">
            <div class="w-16 h-16 bg-green rounded-2xl flex items-center justify-center shadow-lg">
              <i data-lucide="briefcase" class="w-8 h-8 text-white"></i>
            </div>
            <div>
              <h1 class="text-4xl font-bold text-gray-900 font-horizon tracking-wide">HR DASHBOARD</h1>
              <p class="text-gray-500 font-raleway-light mt-1">Human Resources Management System</p>
            </div>
          </div>
        </div>

        <!-- Quick Stats -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-12">
          <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm text-gray-500 font-raleway-light mb-1">Total Employees</p>
                <p class="text-3xl font-bold text-gray-900 font-benzin">24</p>
              </div>
              <div class="w-12 h-12 bg-blue-50 rounded-xl flex items-center justify-center">
                <i data-lucide="users" class="w-6 h-6 text-blue-600"></i>
              </div>
            </div>
          </div>

          <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm text-gray-500 font-raleway-light mb-1">Active Users</p>
                <p class="text-3xl font-bold text-gray-900 font-benzin">18</p>
              </div>
              <div class="w-12 h-12 bg-green-50 rounded-xl flex items-center justify-center">
                <i data-lucide="user-check" class="w-6 h-6 text-green-600"></i>
              </div>
            </div>
          </div>

          <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm text-gray-500 font-raleway-light mb-1">Expiring Certs</p>
                <p class="text-3xl font-bold text-gray-900 font-benzin">3</p>
              </div>
              <div class="w-12 h-12 bg-amber-50 rounded-xl flex items-center justify-center">
                <i data-lucide="alert-circle" class="w-6 h-6 text-amber-600"></i>
              </div>
            </div>
          </div>

          <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm text-gray-500 font-raleway-light mb-1">Pending Items</p>
                <p class="text-3xl font-bold text-gray-900 font-benzin">7</p>
              </div>
              <div class="w-12 h-12 bg-purple-50 rounded-xl flex items-center justify-center">
                <i data-lucide="clock" class="w-6 h-6 text-purple-600"></i>
              </div>
            </div>
          </div>
        </div>

        <!-- Main Sections -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
          
          <!-- Employee Management Section -->
          <div class="bg-white rounded-3xl p-8 shadow-md border border-gray-100">
            <div class="flex items-center gap-3 mb-6">
              <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center shadow-md">
                <i data-lucide="users" class="w-6 h-6 text-white"></i>
              </div>
              <div>
                <h2 class="text-2xl font-bold text-gray-900 font-benzin">EMPLOYEE MANAGEMENT</h2>
                <p class="text-sm text-gray-500 font-raleway-light">Personnel & User Administration</p>
              </div>
            </div>
            
            <div class="space-y-3">
              <a href="hr-people.html" class="group block p-4 rounded-xl hover:bg-gray-50 transition-all duration-200 border border-transparent hover:border-gray-200">
                <div class="flex items-center justify-between">
                  <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-blue-50 rounded-lg flex items-center justify-center group-hover:bg-blue-100 transition-colors">
                      <i data-lucide="user-circle" class="w-5 h-5 text-blue-600"></i>
                    </div>
                    <div>
                      <p class="font-semibold text-gray-900 font-raleway">People Directory</p>
                      <p class="text-xs text-gray-500 font-raleway-light">Manage employee profiles and records</p>
                    </div>
                  </div>
                  <i data-lucide="chevron-right" class="w-5 h-5 text-gray-400 group-hover:text-gray-600 group-hover:translate-x-1 transition-all"></i>
                </div>
              </a>

              <a href="hr-users.html" class="group block p-4 rounded-xl hover:bg-gray-50 transition-all duration-200 border border-transparent hover:border-gray-200">
                <div class="flex items-center justify-between">
                  <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-green-50 rounded-lg flex items-center justify-center group-hover:bg-green-100 transition-colors">
                      <i data-lucide="shield-check" class="w-5 h-5 text-green-600"></i>
                    </div>
                    <div>
                      <p class="font-semibold text-gray-900 font-raleway">User Access Control</p>
                      <p class="text-xs text-gray-500 font-raleway-light">Manage permissions and roles</p>
                    </div>
                  </div>
                  <i data-lucide="chevron-right" class="w-5 h-5 text-gray-400 group-hover:text-gray-600 group-hover:translate-x-1 transition-all"></i>
                </div>
              </a>

              <a href="hr-onboarding.html" class="group block p-4 rounded-xl hover:bg-gray-50 transition-all duration-200 border border-transparent hover:border-gray-200">
                <div class="flex items-center justify-between">
                  <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-purple-50 rounded-lg flex items-center justify-center group-hover:bg-purple-100 transition-colors">
                      <i data-lucide="user-plus" class="w-5 h-5 text-purple-600"></i>
                    </div>
                    <div>
                      <p class="font-semibold text-gray-900 font-raleway">Onboarding</p>
                      <p class="text-xs text-gray-500 font-raleway-light">New hire setup and orientation</p>
                    </div>
                  </div>
                  <i data-lucide="chevron-right" class="w-5 h-5 text-gray-400 group-hover:text-gray-600 group-hover:translate-x-1 transition-all"></i>
                </div>
              </a>
            </div>
          </div>

          <!-- Compliance & Training Section -->
          <div class="bg-white rounded-3xl p-8 shadow-md border border-gray-100">
            <div class="flex items-center gap-3 mb-6">
              <div class="w-12 h-12 bg-gradient-to-br from-amber-500 to-amber-600 rounded-xl flex items-center justify-center shadow-md">
                <i data-lucide="graduation-cap" class="w-6 h-6 text-white"></i>
              </div>
              <div>
                <h2 class="text-2xl font-bold text-gray-900 font-benzin">COMPLIANCE & TRAINING</h2>
                <p class="text-sm text-gray-500 font-raleway-light">Certifications & Safety Records</p>
              </div>
            </div>
            
            <div class="space-y-3">
              <a href="hr-badges.html" class="group block p-4 rounded-xl hover:bg-gray-50 transition-all duration-200 border border-transparent hover:border-gray-200">
                <div class="flex items-center justify-between">
                  <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-amber-50 rounded-lg flex items-center justify-center group-hover:bg-amber-100 transition-colors">
                      <i data-lucide="award" class="w-5 h-5 text-amber-600"></i>
                    </div>
                    <div>
                      <p class="font-semibold text-gray-900 font-raleway">Badges & Certifications</p>
                      <p class="text-xs text-gray-500 font-raleway-light">Track credentials and clearances</p>
                    </div>
                  </div>
                  <i data-lucide="chevron-right" class="w-5 h-5 text-gray-400 group-hover:text-gray-600 group-hover:translate-x-1 transition-all"></i>
                </div>
              </a>

              <a href="hr-training.html" class="group block p-4 rounded-xl hover:bg-gray-50 transition-all duration-200 border border-transparent hover:border-gray-200">
                <div class="flex items-center justify-between">
                  <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-green-50 rounded-lg flex items-center justify-center group-hover:bg-green-100 transition-colors">
                      <i data-lucide="clipboard-check" class="w-5 h-5 text-green-600"></i>
                    </div>
                    <div>
                      <p class="font-semibold text-gray-900 font-raleway">Training Records</p>
                      <p class="text-xs text-gray-500 font-raleway-light">OSHA and safety compliance</p>
                    </div>
                  </div>
                  <i data-lucide="chevron-right" class="w-5 h-5 text-gray-400 group-hover:text-gray-600 group-hover:translate-x-1 transition-all"></i>
                </div>
              </a>

              <a href="hr-badges.html" class="group block p-4 rounded-xl hover:bg-gray-50 transition-all duration-200 border border-transparent hover:border-gray-200">
                <div class="flex items-center justify-between">
                  <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-red-50 rounded-lg flex items-center justify-center group-hover:bg-red-100 transition-colors">
                      <i data-lucide="alert-triangle" class="w-5 h-5 text-red-600"></i>
                    </div>
                    <div>
                      <p class="font-semibold text-gray-900 font-raleway">Expiring Certifications</p>
                      <p class="text-xs text-gray-500 font-raleway-light">Renewal alerts and tracking</p>
                    </div>
                  </div>
                  <span class="px-2 py-1 bg-red-100 text-red-700 text-xs font-bold rounded-lg">3</span>
                </div>
              </a>
            </div>
          </div>

        </div>

        <!-- Secondary Sections -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          
          <!-- Documents -->
          <div class="bg-gradient-to-br from-gray-900 to-gray-800 rounded-3xl p-8 shadow-xl text-white">
            <div class="w-14 h-14 bg-white/10 backdrop-blur-sm rounded-2xl flex items-center justify-center mb-6">
              <i data-lucide="folder" class="w-7 h-7 text-white"></i>
            </div>
            <h3 class="text-xl font-bold mb-2 font-benzin">DOCUMENTS</h3>
            <p class="text-gray-300 text-sm mb-6 font-raleway-light leading-relaxed">
              Store and manage HR policies, handbooks, and company documentation with version control.
            </p>
            <a href="hr-documents.html" class="inline-flex items-center gap-2 text-white hover:gap-3 transition-all font-raleway font-semibold">
              <span>Access Files</span>
              <i data-lucide="arrow-right" class="w-4 h-4"></i>
            </a>
          </div>

          <!-- Reports -->
          <div class="bg-gradient-to-br from-green to-green/90 rounded-3xl p-8 shadow-xl text-white">
            <div class="w-14 h-14 bg-white/10 backdrop-blur-sm rounded-2xl flex items-center justify-center mb-6">
              <i data-lucide="bar-chart-3" class="w-7 h-7 text-white"></i>
            </div>
            <h3 class="text-xl font-bold mb-2 font-benzin">REPORTS</h3>
            <p class="text-green-50 text-sm mb-6 font-raleway-light leading-relaxed">
              Generate comprehensive HR analytics, compliance reports, and export data to PDF or Excel.
            </p>
            <a href="hr-reports.html" class="inline-flex items-center gap-2 text-white hover:gap-3 transition-all font-raleway font-semibold">
              <span>View Reports</span>
              <i data-lucide="arrow-right" class="w-4 h-4"></i>
            </a>
          </div>

          <!-- Settings -->
          <div class="bg-gradient-to-br from-purple-600 to-purple-700 rounded-3xl p-8 shadow-xl text-white">
            <div class="w-14 h-14 bg-white/10 backdrop-blur-sm rounded-2xl flex items-center justify-center mb-6">
              <i data-lucide="settings" class="w-7 h-7 text-white"></i>
            </div>
            <h3 class="text-xl font-bold mb-2 font-benzin">SETTINGS</h3>
            <p class="text-purple-50 text-sm mb-6 font-raleway-light leading-relaxed">
              Configure HR system preferences, notification rules, and manage department structures.
            </p>
            <a href="hr-settings.html" class="inline-flex items-center gap-2 text-white hover:gap-3 transition-all font-raleway font-semibold">
              <span>Configure</span>
              <i data-lucide="arrow-right" class="w-4 h-4"></i>
            </a>
          </div>

        </div>

      </section>

      <!-- Unauthorized Section -->
      <section id="hrUnauthorized" class="hidden">
        <div class="max-w-2xl mx-auto text-center py-20">
          <div class="bg-white rounded-3xl p-12 shadow-2xl border border-gray-100">
            <div class="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-red-500 to-red-600 rounded-3xl mb-8 shadow-lg">
              <i data-lucide="shield-alert" class="w-10 h-10 text-white"></i>
            </div>
            <h2 class="text-4xl font-bold font-horizon mb-4 tracking-wide text-gray-900">ACCESS DENIED</h2>
            <p class="text-lg font-raleway-light text-gray-600 mb-8 leading-relaxed max-w-md mx-auto">
              You need administrator privileges to access the HR Dashboard. Please contact your system administrator if you believe this is an error.
            </p>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
              <a href="index.html" class="inline-flex items-center justify-center gap-2 px-8 py-4 rounded-xl bg-green text-white hover:bg-opacity-90 transition-all font-benzin text-sm shadow-md hover:shadow-lg">
                <i data-lucide="home" class="w-5 h-5"></i>
                RETURN HOME
              </a>
              <a href="contact.html" class="inline-flex items-center justify-center gap-2 px-8 py-4 rounded-xl bg-white text-gray-700 border-2 border-gray-200 hover:border-gray-300 transition-all font-benzin text-sm">
                <i data-lucide="mail" class="w-5 h-5"></i>
                CONTACT ADMIN
              </a>
            </div>
          </div>
        </div>
      </section>

    </div>
  </main>

  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
  
  <script>
    // Function to show error state
    function showError(message) {
      const loadingSection = document.getElementById('hrLoading');
      if (loadingSection) {
        loadingSection.innerHTML = `
          <div class="text-center">
            <div class="inline-flex items-center justify-center w-16 h-16 bg-red-100 rounded-2xl mb-6">
              <i data-lucide="alert-circle" class="w-8 h-8 text-red-600"></i>
            </div>
            <h2 class="text-2xl font-bold text-gray-900 font-horizon mb-2">ERROR</h2>
            <p class="text-gray-500 font-raleway-light mb-4">${message}</p>
            <a href="login.html" class="inline-flex items-center gap-2 px-6 py-3 rounded-xl bg-green text-white hover:bg-opacity-90 transition-all font-benzin text-sm">
              GO TO LOGIN
            </a>
          </div>
        `;
        if (typeof lucide !== 'undefined' && lucide.createIcons) {
          lucide.createIcons();
        }
      }
    }

    // Wait for auth.js to be ready
    function initHRPage() {
      console.log('Initializing HR page...');
      
      // Check if requireAuth is available
      if (typeof requireAuth !== 'function') {
        console.error('requireAuth not available');
        showError('Authentication system not loaded. Please refresh the page.');
        return;
      }

      // Set timeout to catch hanging auth
      const authTimeout = setTimeout(() => {
        console.error('Auth check timed out');
        showError('Authentication check timed out. Please try again.');
      }, 10000); // 10 second timeout

      // Run authentication check
      try {
        requireAuth(async (result) => {
          clearTimeout(authTimeout); // Clear timeout on success
          console.log('Auth check result:', result);
          
          // Hide loading state
          const loadingSection = document.getElementById('hrLoading');
          if (loadingSection) {
            loadingSection.classList.add('hidden');
          }
          
          // Check admin status
          const isAdmin = typeof userHasAdminBadge === 'function' && userHasAdminBadge(result.profile, result.role);
          console.log('Is admin:', isAdmin, 'Profile:', result.profile, 'Role:', result.role);
          
          if (isAdmin) {
            document.getElementById('hrContent')?.classList.remove('hidden');
          } else {
            document.getElementById('hrUnauthorized')?.classList.remove('hidden');
          }
          
          // Initialize icons after content is shown
          requestAnimationFrame(() => {
            if (typeof lucide !== 'undefined' && lucide.createIcons) {
              lucide.createIcons();
            }
          });
        });
      } catch (error) {
        clearTimeout(authTimeout);
        console.error('Error during auth check:', error);
        showError('Authentication error. Please try logging in again.');
      }
    }

    // Try to initialize, with fallback delays
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initHRPage);
    } else {
      // DOM already loaded, wait a bit for deferred scripts
      setTimeout(initHRPage, 100);
    }
  </script>
</body>
</html>
